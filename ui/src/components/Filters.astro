---
export interface Props {
  categories: string[];
  selectedCategory?: string;
  selectedSort?: string;
  priceRange?: { min: number; max: number };
  translations?: any;
}

import {useTranslations } from "../i18n/utils"

const t = useTranslations(Astro.params.locale as "en" | "de" | "es" | "fr");

const { 
  categories, 
  selectedCategory = "", 
  selectedSort = "relevance",
  priceRange = { min: 0, max: 10000 },
  translations = {}
} = Astro.props;
---

<div class="bg-white dark:bg-gray-800 p-3 sm:p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 w-full transition-colors duration-200">
  <div class="flex justify-between items-center mb-3 sm:mb-4">
    <h3 class="font-semibold text-base sm:text-lg text-gray-800 dark:text-gray-200">
      {t('filter.title')}
    </h3>
    <button 
      id="resetFilters" 
      class="text-xs sm:text-sm text-gray-700 border-none cursor-pointer rounded hover:bg-gray-300 dark:text-gray-100 dark:bg-gray-700 dark:text-white hover:text-gray-700 dark:hover:bg-gray-200 dark:hover:text-gray-700 font-medium transition-colors duration-200"
    >
      {t('filter.reset')}
    </button>
  </div>
  
  <div class="space-y-4 sm:space-y-6">
    <!-- Category Filter -->
    <div>
      <h4 class="font-medium text-gray-700 dark:text-gray-300 text-sm sm:text-base mb-1 sm:mb-2">
        {t('filter.category')}
      </h4>
      <select 
        id="categoryFilter" 
        class="w-full p-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white transition-colors duration-200"
      >
        <option value="">{t('filter.category.all')}</option>
        {
          categories.map(category => (
            <option value={category} selected={selectedCategory === category}>
              {category.charAt(0).toUpperCase() + category.slice(1).replace('-', ' ')}
            </option>
          ))
        }
      </select>
    </div>
    
    <!-- Price Range Filter -->
    <div>
      <h4 class="font-medium text-gray-700 dark:text-gray-300 text-sm sm:text-base mb-1 sm:mb-2">
        {translations.filters?.price || "Max Price"}: $<span id="priceRangeValue">{priceRange.max}</span>
      </h4>
      <div class="flex items-center space-x-2 mb-1 sm:mb-2">
        <span class="text-xs sm:text-sm text-gray-600 dark:text-gray-400">$0</span>
        <input 
          type="range" 
          id="priceRange" 
          min="0" 
          max="10000" 
          value={priceRange.max}
          class="w-full h-2 bg-gray-200 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer slider transition-colors duration-200"
        />
        <span class="text-xs sm:text-sm text-gray-600 dark:text-gray-400">$10,000+</span>
      </div>
    </div>
    
    <!-- Sort Options -->
    <div>
      <h4 class="font-medium text-gray-700 dark:text-gray-300 text-sm sm:text-base mb-1 sm:mb-2">
        {translations.filters?.sort || "Sort By"}
      </h4>
      <select 
        id="sortOptions" 
        class="w-full p-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white transition-colors duration-200"
      >
        <option value="relevance" selected={selectedSort === "relevance"}>
          {t('filter.sort.relevance')}
        </option>
        <option value="price-low" selected={selectedSort === "price-low"}>
          {t('filter.sort.priceAsc')}
        </option>
        <option value="price-high" selected={selectedSort === "price-high"}>
          {t('filter.sort.priceDesc')}
        </option>
        <option value="rating" selected={selectedSort === "rating"}>
          {t('filter.sort.rating')}
        </option>
        <option value="popular" selected={selectedSort === "popular"}>
          {t('filter.sort.popular')}
        </option>
      </select>
    </div>
  </div>
</div>

<script>
  // Update price range display
  const priceRange = document.getElementById('priceRange');
  const priceRangeValue = document.getElementById('priceRangeValue');

  
  if (priceRange && priceRangeValue) {
    priceRange.addEventListener('input', function() {
      priceRangeValue.textContent = this.value;
      // Auto-apply when price range changes
      setTimeout(() => applyFilters(), 300);
    });
  }
  
  // Auto-apply when filters change
  document.getElementById('categoryFilter')?.addEventListener('change', function() {
    applyFilters();
  });
  
  document.getElementById('sortOptions')?.addEventListener('change', function() {
    applyFilters();
  });
  
  document.getElementById('resetFilters')?.addEventListener('click', function() {
    document.getElementById('categoryFilter').value = '';
    document.getElementById('priceRange').value = 1000;
    document.getElementById('priceRangeValue').textContent = '1000';
    document.getElementById('sortOptions').value = 'relevance';
    applyFilters();
  });
  
  function applyFilters() {
    const category = document.getElementById('categoryFilter')?.value || '';
    const brand = document.getElementById('brandFilter')?.value || '';
    const maxPrice = document.getElementById('priceRange')?.value || 1000;
    const sortBy = document.getElementById('sortOptions')?.value || 'relevance';
    
    if (typeof window.applyFilters === 'function') {
      window.applyFilters(category, brand, maxPrice, sortBy);
    }
  }
</script>

<style>
  .slider::-webkit-slider-thumb {
    appearance: none;
    height: 16px;
    width: 16px;
    border-radius: 50%;
    background: #3b82f6;
    cursor: pointer;
    border: 2px solid white;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  
  .slider::-moz-range-thumb {
    height: 16px;
    width: 16px;
    border-radius: 50%;
    background: #3b82f6;
    cursor: pointer;
    border: 2px solid white;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  
  .dark .slider::-webkit-slider-thumb {
    border: 2px solid #1f2937;
  }
  
  .dark .slider::-moz-range-thumb {
    border: 2px solid #1f2937;
  }
</style>