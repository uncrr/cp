---
export interface Props {
  initialQuery?: string;
  selectedCategory?: string;
  selectedSort?: string;
  priceRange?: { min: number; max: number };
}

import {useTranslations } from "../i18n/utils"

const t = useTranslations(Astro.params.locale as "en" | "de" | "es" | "fr");
const { 
  initialQuery,
  selectedCategory,
  selectedSort,
  priceRange,
} = Astro.props;

---

<div class="max-w-2xl mx-auto px-2">
  <form id="searchForm" class="relative">
    <div class="relative flex rounded-lg shadow-sm">
      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </div>
      <input
        type="text"
        id="searchInput"
        name="q"
        value={initialQuery}
        placeholder={t('search.placeholder')}
        class="block w-full pl-10 pr-4 py-3 text-sm sm:text-base rounded-l-lg border-none dark:bg-gray-700 dark:text-white transition-colors duration-200"
        autocomplete="off"
      />
      <button
        id="searchButton"
        type="submit"
        class="px-4 sm:px-6 py-3 cursor-pointer border-none dark:hover:bg-gray-800 hover:bg-gray-800 hover:text-gray-200 font-medium text-sm sm:text-base rounded-r-lg transition-all duration-200"
      >
        {t("search.button")}
      </button>
        <input hidden type="text" id="sort" name="sort" value={selectedSort}>
        <input hidden type="text" id="category" name="category" value={selectedCategory}>
        <input hidden type="number" id="maxprice" name="maxprice" value={priceRange?.max} >

    </div>
  </form>
  
  <script>
    // Get the form element
    const form = document.getElementById('searchForm');

   form.addEventListener('submit', async (event) => {
    // Prevent the default form submission (which would cause a page reload)
    event.preventDefault();
    
    // Get the values from the form inputs
    const query = form.elements.q.value;
    const category = form.elements.category.value;
    const maxPrice = form.elements.maxprice.value;
    const sortBy = form.elements.sort.value;
    
    try {
      // Send a POST request to your Python API endpoint
      const response = await fetch('http://0.0.0.0:8000/api/search', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          search_input: query,
          category: category,
          max_price: maxPrice,
          sort_by: sortBy
        })
      });

      // Handle the response from the API
      if (!response.ok) {
        throw new Error(`API error: ${response.status}`);
      }

      const data = await response.json();
      console.log('Search results:', data);

      // Display the results on the page
      JSON.stringify(data, null, 2);

    } catch (error) {
      console.error('Error fetching search results:', error);
    }
  });

   </script>
</div>